![1567044038533](assets/1567044038533.png)



[TOC]







# 第四单元 FTP服务



## 4.1 FTP 服务概述	

**FTP** 是`File Transfer Protocol`（**文件传输协议**）的英文简称，它**工作在OSI模型的第七层**，TCP模型的第四层上，即应用层，使用TCP传输而不是UDP，这样FTP客户在和服务器建立连接前就要经过一个被广为熟知的”三次握手”的过程，它带来的意义在于客户与服务器之间的连接是可靠的，而且是面向连接，为数据的传输提供了可靠的保证。

FTP服务使用FTP协议（文件传输协议）来进行**文件的上传和下载**，可以非常方便的进行远距离的文件传输，还支持断点续传功能，可以大幅度地减小CPU和网络带宽的开销，并实现相应的安全控制。

FTP会话时包含了两个通道，一个叫**控制通道，端口号21**；一个叫**数据通道，端口号20**。 
控制通道：控制通道是和FTP服务器进行沟通的通道，连接FTP，发送FTP指令都是通过控制通道来完成的。 
数据通道：数据通道是和FTP服务器进行文件传输或者列表的通道。

ps:主动模式要求客户端和服务器端同时打开并且监听一个端口以建立连接。在这种情况下，客户端由于安装了防火墙会产生一些问题。所以，创立了被动模式。被动模式只要求服务器端产生一个监听相应端口的进程，这样就可以绕过客户端安装了防火墙的问题。

FTP和NFS、Samba ：三大文件共享服务器。

FTP软件：vsftpd,wu-ftp,proftp等

最常用的FTP服务器架设使用vsftpd软件 ：安全“ very secure”











### 4.1.1FTP服务的两种工作模式

ftp协议的连接方式有两种，一种是命令连接，一种是数据连接，而ftp的数据连接方式也有两种，一种是主动模式，一种是被动模式。(FTP协议中，控制连接均有客户端发起，而数据连接有两种工作方式)

FTP的两种工作模式：

主动模式：消息端口21，数据端口20

被动模式：消息端口21，数据端口 随机



1.主动模式的工作原理（PORT模式）
1.客户端对服务器发起请求，连接的是服务器的21号端口，客户端的端口号N是大于1024的随机端口 
2.服务器的21号端口给予客户端响应数据流 
3.服务器打开20号端口去连接客户端的N+1的端口 
4.客户端给予响应，数据开始传输

2.被动模式的工作原理（PASV模式）
1.客户端对服务器发起的请求连接是服务器的21号端口，客户端的端口号N是大于1024的随机端口 
2.服务器的21号端口给予客户端响应 
3.服务器打开一个大于1024的随机端口，客户端使用N+1端口号去连接服务器打开的端口 
4.服务器给予响应，于是数据开始传输 
需要注意的是：客户端如何连接服务器端的这个随机端口的呢？在命令连接阶段，服务器会传输172.16.1.1.113.26的字符串过去，前四个标识的是服务器的IP地址，而随机端口是通过后面两个字符计算得出的，计算法则为第一个乘以256加上第二个数，即客户端连接服务器端的这个随机端口号是113*256+26




​	

### 4.1.2vsftpd软件	

4.2匿名用户默认配置	
4.2.1匿名用户默认共享目录	
4.2.2匿名用户默认的权限	
4.3匿名用户常用参数	
4.3.1anon_upload_enable参数的意义	
4.3.2anon_mkdir_write_enable参数的意义	
4.3.3anon_other_write_enable参数的意义	
4.4FTP客户端	
4.4.1Linux下FTP客户端	
4.4.2Windows下FTP客户端	
4.4.3客户端下载和上传文件
4.5设置本地用户登录FTP	
4.5.1设置SELinux为警告模式	
4.5.2创建FTP本地用户限制不能登录系统	
4.6本地用户默认配置	
4.6.1本地用户默认共享目录	
4.6.2本地用户默认的权限	
4.7FTP限速等参数	
4.7.1max_clients参数的意义	
4.7.2local_max_rate参数的意义	
4.7.3anon_max_rate参数的意义	
4.7.4max_per_ip 参数的意义

